# 機能仕様書：GUIベース軽量高速マイクロVMノード作成プラットフォーム

## 1. 概要

本仕様書は、高速・軽量なマイクロVMノードをGUI/CLIから作成・管理し、ネットワーク構成や障害シナリオ、分散処理への応用を可能にする仮想化プラットフォームの機能について記載する。

---

## 2. 機能一覧

| 機能ID | 機能名                                 | 概要                                                                 |
|--------|----------------------------------------|----------------------------------------------------------------------|
| F-01   | マイクロVM作成                         | GUIまたはCLIからマイクロVMを作成                                    |
| F-02   | マイクロVM起動・停止・破棄             | VMの状態制御（起動、停止、削除）                                    |
| F-03   | 複数VM構成によるノード構築             | 1機能1VMのノード構成をGUIで定義可能                                 |
| F-04   | スナップショット生成と複製             | VMの状態を保存し、同構成VMを複製生成                                |
| F-05   | 資材（バイナリ、設定）転送             | ローカルまたは指定リポジトリからVMに資材を転送                     |
| F-06   | 異なるOS構成VMの対応                   | 複数Linux系OSのVM構成に対応                                         |
| F-07   | CLI/APIによる自動操作                   | GUIに加えてCLI/APIからの作成・管理に対応                            |
| F-08   | ネットワーク構成管理（L2/L3）           | 仮想ネットワークのGUI構成（ブリッジ/VLAN/ルーティング）             |
| F-09   | ネットワークイベント操作               | 起動中VMのIFダウン、再接続などの動的ネットワーク操作                |
| F-10   | 疎通/障害シナリオ実行                  | ping, curl 等による疎通確認や障害注入のシナリオ再生                |
| F-11   | 分散ノード構成の一括起動・破棄         | 処理単位でのノード一括作成・終了                                   |
| F-12   | 瞬間的VPN/ネットワークセグメント作成   | ユーザーやリクエスト単位の専用ネットワーク構成                      |
| F-13   | リクエスト駆動型ノード起動             | リクエストトリガで即時ノード作成・処理後破棄（イベント駆動型）     |

---

## 3. 機能詳細

### F-01: マイクロVM作成
- **入力**: OSイメージパス、CPU/メモリ量、NIC情報、オプション（スナップショット/資材添付）
- **出力**: 作成されたVMのIDと状態
- **制約**: KVM有効なホスト上でのみ動作

---

### F-03: 複数VM構成によるノード構築
- **概要**: 機能単位にVMを定義し、複数VMを「ノード」として扱う
- **構成例**:
  - APIハンドラ（VM-A）
  - DBキャッシュ（VM-B）
  - 外部連携ゲートウェイ（VM-C）
- **管理単位**: ノード単位で起動・停止・破棄可能

---

### F-08: ネットワーク構成管理
- **入力**: GUIでノード間のリンクやルーティングを定義
- **出力**: 実ネットワーク構成（Linux bridgeやtcによる構成）
- **制約**: VM間通信が許可された範囲でのみリンク作成可

---

### F-10: 疎通/障害シナリオ実行
- **操作**:
  - ping/curl等の疎通スクリプトをVM間で定義
  - IFダウンやVMリブートなどの障害をタイミング付きで注入
- **再実行**: シナリオは保存・再利用可能

---

### F-12: 瞬間的VPN/ネットワークセグメント作成
- **目的**: ユーザーA/B間の通信を論理的に分離したネットワークで処理
- **処理**:
  - リクエスト受信時に分離セグメントを作成
  - 通信終了後に関連ノードとネットワークごと破棄

---

## 4. 入出力インターフェース

- **GUI**: Webベース、ドラッグ&ドロップによるノード設計、ステータス可視化
- **CLI**: `vmctl` のような独自コマンドラインツール
- **API**: RESTベース（POST: VM作成, DELETE: VM破棄, GET: 状態取得など）

---

## 5. 状態遷移図（例：マイクロVM）

[作成要求] --> [準備中] --> [起動済み] --> [停止済み] --> [破棄済み]
[作成要求] --> [エラー]
[準備中] --> [エラー]
[起動済み] --> [エラー]
[停止済み] --> [エラー]

---

## 6. 制約・前提

- VMはrootlessではない（KVM使用）
- 起動時間は100ms～数秒を想定（ミリ秒単位の処理には未対応）
- GUIクライアントはローカル or Webベース（Electron等も選択肢）

---

## 7. 今後追加予定の機能（参考）

- VM内部のメトリクス収集とダッシュボード表示
- VMをファンクションとして扱うServerless機構
- ノード単位のリソース制限とQoS制御

---

## 8. 参考構成図（要望があれば図を提示可能）
- GUI
- マイクロVMマネージャ（VMM）
- スナップショットストア
- ネットワークマネージャ
- シナリオ実行エンジン

---