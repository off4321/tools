# 技術仕様書：軽量高速マイクロVMノード構築プラットフォーム

## 1. 概要

本プラットフォームは、高速・軽量なマイクロVMを複数組み合わせてノード構成とし、GUIおよびCLI/APIから柔軟に構築・操作できる仮想化基盤を提供する。目的は、教育用途、ネットワーク/障害検証、さらには商用のエッジ処理・分散処理に対応するマイクロサービス的PaaS機能の提供である。

---

## 2. システム構成概要

+--------------------------+
|      GUI Frontend       |   ← Electron / Web UI
+--------------------------+
              |
              v
+--------------------------+
|       API Gateway        |   ← REST API (Flask / FastAPI)
+--------------------------+
              |
              v
+-------------------------------+
|   VM/Node Controller (VMM)    |
|  - VM lifecycle management    |
|  - Node orchestration         |
+-------------------------------+
              |
      +-------+--------+
      |                |
      v                v
+-------------+   +------------------+
|     KVM     |   |   Net Manager    |
|   (QEMU)    |   | - bridge / VLAN  |
|             |   | - routing / tc   |
+-------------+   +------------------+
              |
              v
    +--------------------------+
    |  MicroVM Instances (Linux) |
    +--------------------------+


---

## 3. コア技術スタック

| 区分             | 使用技術候補                  | 説明                                           |
|------------------|-------------------------------|------------------------------------------------|
| 仮想化基盤        | KVM / QEMU(下記独自VMM使うなら不要)                    | 基盤としてKVMを使用し、最小限構成のVMを高速起動 |
| ランタイム管理    | 独自VMM（Rust/Go）            | 独自実装のVMマネージャでFirecracker風制御      |
| イメージ管理      | QCOW2 / raw                   | ディスクイメージ形式                           |
| コンテナ連携      | docker (option)               | VM内部に軽量コンテナ導入も可能                 |
| GUI               | Electron / Web Frontend       | ノード・ネットワーク構成の可視化/操作          |
| CLI/API           | REST + CLI                    | 自動化/操作スクリプト対応                      |
| ネットワーク構成  | Linux bridge / VLAN / netns   | VM間の仮想ネットワーク                          |
| ファイル転送      | SSH / virtio-fs / 9pfs         | VMへの資材転送                                 |

---

## 4. 外部依存関係

- KVM対応Linuxカーネル（ホスト）
- systemdまたは軽量init（VMゲストOS）
- Python/Rust環境（VMM実装向け）
- 必要なOSイメージ（Debian minimal, Alpine, Ubuntu minimalなど）

---

## 5. VM仕様

| 項目         | 内容                      |
|--------------|---------------------------|
| CPU数        | 1～2 vCPU（指定可能）     |
| メモリ       | 64MB〜512MB               |
| OS           | Linux系最小構成           |
| 起動速度     | 100ms～1秒程度（目標）    |
| ストレージ    | QCOW2またはraw（10MB程度）|
| 通信         | bridge/VLAN/netns対応     |
| 起動方式     | cloud-initまたはvirtio    |

---

## 6. ノード構成モデル

- ノード：1～N個のマイクロVMによって構成される論理ユニット
- 典型構成例：
  - Web API + Cache + Logger = ノードA
  - L3 Router + VPN + IDS = ノードB

---

## 7. セキュリティと隔離

| 対策項目         | 対応方針                                               |
|------------------|--------------------------------------------------------|
| VM間隔離         | ネットワーク名前空間、仮想NIC、firewallによる隔離    |
| 権限管理         | GUI/API操作の認証認可（JWT, OAuth等）                 |
| VM内攻撃耐性     | AppArmor/SELinuxのテンプレート構成                     |
| 外部公開制御     | 外部NICに直接接続されない設計                          |

---

## 8. パフォーマンス要件（目標値）

| 項目               | 目標値                          |
|--------------------|---------------------------------|
| 単一VM起動時間     | < 1 秒                         |
| ノード起動時間     | < 2 秒（5VM構成時）            |
| VM数               | 10～50（ホスト1台当たり）      |
| 操作反応時間       | GUI/APIともに1秒以内応答       |

---

## 9. テスト方針（抜粋）

- 単体テスト：VMM制御、ノード定義、シナリオ実行
- 結合テスト：GUI ↔ API ↔ VMM連携確認
- ネットワークテスト：構成通りの通信経路の確認
- パフォーマンステスト：VM起動時間測定、同時起動試験

---

## 10. 今後の拡張ポイント

- Firecracker直接対応（非QEMU起動）
- WASMバイナリによるVM制御スクリプト
- 外部クラウド連携（オンプレ+クラウドハイブリッド）
- VMベースServerless（Function as a VM）

---